<div class="product-detail-container">
  <button class="back-button" (click)="goBack()">
    <i class="bi bi-arrow-left"></i> Back to store
  </button>

  <div *ngIf="isLoading" class="loading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading product details...</p>
  </div>

  <div *ngIf="!isLoading && product as selectedProduct" class="product-detail">
    <div class="product-image-section">
      <div class="main-image">
        <img [src]="selectedProduct.image" [alt]="selectedProduct.name" decoding="async" fetchpriority="high">
        <div *ngIf="getDiscountPercentage() > 0" class="discount-badge">
          -{{ getDiscountPercentage() }}% OFF
        </div>
      </div>
      <div class="thumb-row">
        <button class="thumb active">
          <img [src]="selectedProduct.image" [alt]="selectedProduct.name + ' thumbnail'" loading="lazy" decoding="async">
        </button>
        <button class="thumb" disabled>
          <span>+</span>
        </button>
        <button class="thumb" disabled>
          <span>+</span>
        </button>
      </div>
    </div>

    <div class="product-info-section">
      <div class="product-header">
        <div class="category">{{ selectedProduct.category }}</div>
        <h1>{{ selectedProduct.name }}</h1>
        <div class="rating-section" *ngIf="selectedProduct.rating">
          <span class="rating">
            <i class="bi bi-star-fill"></i>
            {{ selectedProduct.rating }}/5.0
          </span>
          <span class="reviews">({{ selectedProduct.reviews }} customer reviews)</span>
        </div>
      </div>

      <div class="pricing-section">
        <span class="current-price">Rs {{ selectedProduct.price }}</span>
        <span *ngIf="selectedProduct.originalPrice" class="original-price">Rs {{ selectedProduct.originalPrice }}</span>
        <span *ngIf="getDiscountPercentage() > 0" class="savings">
          You save Rs {{ selectedProduct.originalPrice! - selectedProduct.price }}
        </span>
      </div>

      <div class="stock-section">
        <span [ngClass]="{'in-stock': selectedProduct.inStock, 'out-of-stock': !selectedProduct.inStock}">
          <i [ngClass]="{'bi bi-check-circle': selectedProduct.inStock, 'bi bi-x-circle': !selectedProduct.inStock}"></i>
          {{ selectedProduct.inStock ? 'In Stock' : 'Out of Stock' }}
        </span>
        <span class="delivery">Dispatch in 24-48 hrs</span>
      </div>

      <div class="description-section">
        <h3>Description</h3>
        <p>{{ selectedProduct.description }}</p>
      </div>

      <div class="specifications-section" *ngIf="selectedProduct.specifications">
        <h3>Specifications</h3>
        <table class="specs-table">
          <tr *ngFor="let spec of selectedProduct.specifications | keyvalue">
            <td class="spec-key">{{ spec.key }}</td>
            <td class="spec-value">{{ spec.value }}</td>
          </tr>
        </table>
      </div>

      <div class="action-section">
        <div class="quantity-section">
          <label>Quantity</label>
          <div class="quantity-control">
            <button (click)="decreaseQuantity()" [disabled]="quantity <= 1">-</button>
            <input type="number" [(ngModel)]="quantity" min="1" readonly>
            <button (click)="increaseQuantity()">+</button>
          </div>
        </div>

        <div class="buttons">
          <button class="add-to-cart-btn" [disabled]="!selectedProduct.inStock" (click)="addToCart()">
            <i class="bi bi-cart-plus"></i> Add to Cart
          </button>
          <button class="buy-now-btn" [disabled]="!selectedProduct.inStock" (click)="buyNow()">
            <i class="bi bi-lightning-fill"></i> Express checkout
          </button>
        </div>
      </div>

      <div class="sku-section">
        <p><strong>SKU:</strong> {{ selectedProduct.sku }}</p>
      </div>
    </div>
  </div>

  <div *ngIf="!isLoading && !product" class="not-found">
    <p>Product not found.</p>
    <button (click)="goBack()">Go Back</button>
  </div>

  <!-- Related Products Section -->
  <div *ngIf="relatedProducts.length > 0" class="related-products-section">
    <h2>Style it with</h2>
    <div class="related-products-grid">
      <div *ngFor="let relProduct of relatedProducts" class="related-product-card" (click)="viewRelatedProduct(relProduct.id)">
        <div class="related-product-image">
          <img [src]="relProduct.image" [alt]="relProduct.name" loading="lazy" decoding="async">
        </div>
        <h4>{{ relProduct.name }}</h4>
        <div class="related-product-price">
          <span class="price">Rs {{ relProduct.price }}</span>
          <span *ngIf="relProduct.originalPrice" class="original">Rs {{ relProduct.originalPrice }}</span>
        </div>
        <button class="view-btn">View</button>
      </div>
    </div>
  </div>
</div>

